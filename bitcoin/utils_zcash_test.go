package bitcoin

import (
    "testing"

    "github.com/stretchr/testify/require"
)

func TestDecodeOutputs_ZcashV5(t *testing.T) {
	rawTx := "050000800a27a726f04dec4d00000000f4493700010000000000000000000000000000000000000000000000000000000000000000ffffffff0603f449370106ffffffff0240597307000000001976a91402b7b5b3afa00d56eb1a2e76b8db889c935c3f1088ac20bcbe000000000017a9147a86d6c7eb12ce0aa309d7391a6f338eba3c242b87000000"

	outputs, err := DecodeOutputs(rawTx, "zcashtestnet")
	require.NoError(t, err)
	require.Len(t, outputs, 2)

	require.Equal(t, uint(0), outputs[0].OutputIndex)
	require.Equal(t, uint64(125000000), outputs[0].Amount)
	require.Equal(t, "tm9xikw8UhJXxUTsWphMfGvGPcjL1PA3CHz", outputs[0].Address)

	require.Equal(t, uint(1), outputs[1].OutputIndex)
	require.Equal(t, uint64(12500000), outputs[1].Amount)
	require.Equal(t, "t2HifwjUj9uyxr9bknR8LFuQbc98c3vkXtu", outputs[1].Address)
}

func TestCalculateTXID_ZcashV5(t *testing.T) {
	rawTx := "050000800a27a726f04dec4d00000000f4493700010000000000000000000000000000000000000000000000000000000000000000ffffffff0603f449370106ffffffff0240597307000000001976a91402b7b5b3afa00d56eb1a2e76b8db889c935c3f1088ac20bcbe000000000017a9147a86d6c7eb12ce0aa309d7391a6f338eba3c242b87000000"
	expectedTxID := "dc7cfca537414cbf45b568f7afad4ccdd402b8455fbdf9b5fed26e96b3fe4a83"

	txID, err := CalculateTXID(rawTx, "zcashtestnet")
	require.NoError(t, err)

	require.Equal(t, expectedTxID, ReverseHex(txID.String()))
}

// TestCalculateTXID_ZcashV5_WithOrchard tests TXID calculation for a Zcash v5 transaction
// that contains Orchard shielded components. This verifies that the BLAKE2b hashing
// implementation correctly handles the Orchard actions digest.
func TestCalculateTXID_ZcashV5_WithOrchard(t *testing.T) {
	// Transaction from Zcash testnet block 3625137
	// This transaction has 2 Orchard actions and 1 transparent output
	// RPC verification: http://65.21.67.137:18232/
	rawTx := "050000800a27a726f04dec4d00000000d8503700000180c3c901000000001976a91448d094e575ccdb18c021ef25feed53b885decba088ac000002360330b959920fcbb18899886473200c4f5c4b9020dede76bfce838db8fbb1b8b4993f80320987a81f2c4f72a8466115d8f280c81a0b5eac859a1170a19cfc150b87d56a40a207746988696c806b7fccf38cef04223505c46df32eea9ba2d28bd5ab523c33a5a97027228f9750afe6358e6bb2dec113134f033f7bbbc1af282da0dafad67a016976c2c3b6c051a1a1aef1d8d55d63c04cadb5c585ca61ef4f1f58707f9c4d6adf5c444244c26bd66f373d30ea360815effb86d2c188e217bad460b53a48c6d0d67216c4599049ae3fc2acafd419282e22868f1f858fffb46f367314b64c664640dd9ecf3f75558d87adf8f5648c143ce7351fb314c0b2b1b51e1a78e51bd3c20ac328ba33d2a148b314a649e40a0cd229ce8ce746bf7f34ab44e5dcd1c4994c8f4e0925ae98626eb7315eae13a78aa4613bacbde5ea5ba6f6c41c1c893b959db391a3536de9ada97845ed34ceca129f2abeb706b8b645303b68ae90888be4ea0b43522e82ebf8bd72c1d7fc795f5b2ffb7bf8eabe3ada4ce155a67f9f46e0a8104d668352e3e17edaa42ee98b896ed93e6dddb5408b674dcf0562e8a63e98b38603eed4a780af284d026dbec32a20fdaa77a965865d154bee7185c68ebb952823dd6e3626f894f2febb067c130f352dda7cca2ce2d2c291d553668f06ecbcdbea4506135fe6a1002beeadab8b4e5bff364565c55314e347b1e3a111b8228000e73e703e72cb1294ff50961b8972048b07151471eda4180a81f7efd7c48df418b752083699fe6fef2f1dac166440d412289efef8d6ce5d75a375f363b33cf386266dd20e0f88f24a5d9dffa47fca51f9bee854cacaf9771a58d98f91eed0be345a95c1cc9943e0565799226db74de1377ce6fef9e947a6b1bc4ac2b68c31c9f4c50d42c8b674d5888eb7dd78afb1b3e6d911c11f19eaa0e6c4f5f8cb439472276689385eece41b513920da1852d273c69c68217e4474387b402e263ab17f785d07826471ff74031f6d7a2034956d6d9755830e1f40cc8654d339dedb40f83c78138a66076cdd28c69ce36379e39b7e2ae780de7b1679298c1f4a33dda4e97e426c74dab1f6145694923eefe294b5526aedd7f56f3f1a3d6cf2a032c2db5cfb2f3d797bafabdce9d11c7785f7480eb89ebb6be54c98928d1e8ece4491cb3afb11f2ea801d37d65df309b4a82a9a33761a05e84dc5e0ce1b0e2894bdc9b36a9e3aa3940a3844ef121ca6bd2d822935e1d51bca4963872da2eccf49ecce659e6ab39fa78c2e0a75af38c3e75a3122a10c9c5f0a9f081b68541d968a073257921d000a2c3a6c87aa5b7dd07ee78416159932829349676be6bc350c18f8c7505e7c9d6be6421cb6a5dd4a2f040b6c66a07cd75c65ff8f50b8978af01410762293cbdf2f6751c57683c1616e7f1da065d444bfa6d950f57e6c0a98a4a35e6c4bd930b45aae8dc6b6b9be3bf4fccc9640b397feb527d10d2159b042ff24ba7f53456b21293d84b949534c8b2bf5b5f20b60abe7cd05e084c3f29d3e3e615fe00eda4c0f19610469a9cbdc858c21030b47dcc5a9e378c371686c91871f920502ae8ff7a545d23092fd189dbaf1cc09c41f9a6a0bcea8173eafae463e2e0952733233eba7f798ca448ed8d8c89a4cefe0a67e543cb0724f4ce70b6acd8ba39f05591a0dec9a3edfc2e121514033ff699d9d6ff745e82f03de0f1736996101a44e381dfdb1770487417dc002090a8b92efacd47aed06d76cf5e95fb38ad5b76345b8b09fd7d6b9486dfcf3e14e00a805cc4a809d131d1c3e2488650698e273b864484fddd910580a2e39367750abad3c0e307638016a85bf660c112bfe8510911e01fbddf33dcd5ac74655ceec44cae8f44188672bf44f862ed65b8b211010af5f640533febcbbebbf29d4554351c1ba768752f5570ed29d04dcf88af267b3c85f0c611a764bc66a61967288b4ccbe42916093afc5665787342d2ed95b25f1932b73412978b6621935d3448c73bf51475e746cbfaa63424e3cb910c4d0871ccda96b67c24a4c9603ba284a140cebaaaa4806610070d9e60b10e6fa86d892d7b59b6062c2c40772a9140a0dfc83a935d804dd55dae169ff1c0ee157cc0290730a0bb232cb9506749eea8852c452de6f983ce69123fd836387a3dcbe31bfda549b479ac7c7dda3e27ac929cdaecc51b0c5d68e0ac591dcb43ca219250e97f647cec594f079b631d66d122d809146409e37b7bfc8b4301ce30e98a562ecbdf49b438d518417bac58e68be796668be73fc6cc0967706a945fa12417dffed6fb24a7c1183e1d84cb91f0318fec90100000000670a083636e279714d39a644d5c63d367dbe2ae23e0ce770629bee5395d84907fd601cefa13a952a5e69236c32f5c7bad01eedc19421ff2d42a2269d81d330e19dc525fe3f4dafe461f0b234a9477cb410f1513c574b975581fe66037c6b4c2cbd3cb9beb0a8e9e46312691bba3e016182f27d7f4d464bc91b0c8efb83ebd3713ec4a8893537fbcc3b4f3a60fe0ac2ab5815f261b845a89d2fcde1e72200d6d876d337d13ecc09424be84d2247f9986db18a111d368221aa8bf11b9dfbf7bbaf9e91a2ae96908606645447972771d650eae56700105ce9f7dd7fae81903532e52cca80acf44e8882f1efe997936601a57de35ce5281fb4e691d08ab380186e09cec01f2628e878693ea4264842033cf082c741a271f51583f99a94e0eda771f2dd88129e8ed96ce2df3c0981f6b1cf61cf4cebea56f0bb8573f3095d333edfb1aa4d2677dcb7025340fbe8844ce4b6c29150faf9ff28d745de7d8109c344a16f85ab21867d4950c7a08787b1af76edfd1df0da14660099a9d83c4bc58c41df5e0ed814498f8de6415cb4e5c330bbe519700f3cef293f3946c168130c1b9fd15d0d24a7daa16491157c53554e7baa9a5e6b8ea42f66a27ff40762e895fd4a1f5adf7d2b2514f13e0e342ae00cf77e1f87cd1a9ce6e24afe50ef512a5e4ed2fd0eca46a910db181e7a4b99b4b30a8ca3cec498ac51f6086fcf3a084b98ddf4a727872008ce6a760617fabc35467870202eec48f9a549675780db2c679569d550ddb8f0adb83af5d93b0d35c9750f0cf21b299491924923e01cb7d803d6feda467cff3e3e3358ec7ea219811c20c984cc925d57269f395922fa323b40b25d43da422418361758a74444ab19c751988da004a58be7de93cf339555272469b4bbd8fd461ca4a9a834c6e942e0995190729b1c98232e208f3446c57b453fcf3511b3e2de86a98f4c9e48eb915435ed419612139f53839bafae9ca0fc22ec14a76eec9e0b2432942c9c17a4c2b56bd553559b529cab5e60db28d751b3b40411878b54317709a5e8a00f0fc43a7e3988c057c7df174ed86752a1dd51354d0c854595edcec50c217cbb183d407ee044d5e434218d1187e51bef41ff10c5bc9724c0955b9cbb5c0fadf5e29e384004871a7433be0c4b30a712e438241a3e5890fc698ec618a177816b0bbe5f1913730bc4d935c9cd2a59146510fa198b40e5e9cb81f6c1beb59b987957117ca84231977594e5524765e4827c77148f219a2a36b5e9cdf0f9bc433968f9610e412435981c8df464977475ae90f4f90313afc2c8a70b16852510341ed7ee98d5578c1359a84964adbd1fbb2fe2e50d419325d04e7f10f717c9bc008479e62cdd02852d6fc06268a0fba28ca7a13c01b947f245ae854bb629170d38b54419b1e4ceba0765823330a959fd025351bcb2605ee74f78eba423edab628625c1e6e2c9f3bd29ef169b93fb97cf129dabd79879df6babad076c39f98ee578a0993805a8863c378b007f19f4ec5714e93c825a4fba4b18ac8c77ed542b2d1619b0a427def8f54a732beb8f02e6fa4df8157ff1d5365a9be8316eda5467bc0f3d3bb846e6e1f1e7491f34a7c3648e184983327433a2ed7634c2cc56939769c310e632e48c82bdcd2af71899f1f8c27befa86c3fab9f89f5aa466d436cf68e21bf656e7c34e5fb3920f759e0f2301f5d1d71b531d88fbcb690be945048a5ac481269fd190b8a197bdc9ceba91597548c23cbab95e40e4db89de1a9c85a6da55fa290e33ae626308e02336094d839dd4d30556790db9d13749707ed8c8e8f49c693037ebb25ae77ab775ffaf009201a1c856832889d1b85af149a1c4a2416f7e7194e9b389195b101ed87797486db7193b0ac335908ee5e0f3ded6d8e8fc845ac070f81c45e1600cbeeb06e19a220730848fcf935ac77e3cc56bd65feb0477ec010631db9d4482046e0f80f6c85e022d0f09e7b423312c093105d917cab2d488eb9e7b984620c065930c88ea188c207e7d137be28a192eef9f5c4ffd4c9f0218b3b2d585a98ce0aabc419022af41c0e1b46b13d97e0b21a5a218d4d9310a525f699e5654b38ccd34c0bc63a1577e8f68120b40110a06e7969cbda914f9b34db24265c0f4091822c402d6b6b7a367d0ab85f318fd65950a4dcee76ea754ba57dda12e43270eb807397b9d3f395d005007a6156e291e1eb203772497ac652d1c64f958bdaa67643557b7a5f51760ba00b6edc87c1cf76fd71c85443e740691d914c9e5c0184d913cea0aeb352c6f1feb263d2fb6e5d0dc2a44359cbbdfaf3a65c50862808b1b6f84787c8cd40845a1ac55d7756624fab295f7993439bffaafafeb223a70cc53424298f0be44660f4ce2681ca0b4318fb170b0140775b45b5f2112f06a071cf23dd0c9696aa761094eb42f2da8e27c9e9f167c99a86eb53d915930000d5247722c6ebaba89ab6f3b8eccc3a67b19b0c1d6c012d81179f78cede6e0818105d99a92a15e2a4eb01d9c9f0d8752ee9909ad6c3b9d9d7d3f04d5af22647099152aea69625dff93e371e31deb28f53a90b5a385340c426202defe0f5683915bfc24741c743f4ff3de88e9227a409139c2b12e9938c92422b99ce3355120412497f200b9147d779fc93312a7a4b568a207b4cfe2cccd895fb7fdff3c1dd251d7ce87477f03858c96ef331a9cafe358b72c3802ee5512521034e276e3176791eac5849c3c2ea5bea45463dece300dfb4c965e7c57cfb3426879a3d67243ece29e359d92e1a0aaef846be18f3c0b26a038e681b6756c82fb03e65931018d0aa0f12461c3deaa77c2f4657a8c1ddd22ca6e7a4e4a1f84fe17785d0d8ec5af7ea368d99b23720261293ca06c674fde4c9638204e3a57ebf867a0fd0a4a9f12270115e1c94a6a1146ea466fd16cf2995f963af1e80dbc44f43ece2f65d26a99a731fdf038a79ae2f0b6f9caab655e105df38b20951f2e6255f7146d46318c96920209b85727222522ddb42fad47425016c5ff565f459ce51939eacdd1bdcb504ff31f20a0fe53913d365b3b168079a0569e57d0d1554e8db391cd9f9ea04bb4ef1026ba4aead62c29381237e0832de05234984d60dbda4cfa9d0658f02138a89033269ed87deb22f25dd51479e2115bff7dc551416f55c56993f229bdf6017f09319c098914eda0579e8324a1e568a16d844cde417d7466f032fceb60828f7499322ce888542c001c4d2fb5b18ddc64945b3c7e6cf535d4efa4646ab6087890b7007d45a08f25974df586313added9810fb9575f6dc91a4c957c05faae17d1516023bc7ae205d5b1f07c64133e76ff0c3a14a1148655ede43ac508326111e732392d7005fbcdbded726c5de77312d6f46eb1f2b6f63af743bda97e37fa0a4df649396ef260ae2b781a26ac0d7e8e83a5bdaaf250821f603e28782da113036c30d81f7e84a957cab89e740b4914277aa4d90b5213e9927be483537209e9e7046b5b1f6875fe94b31125dd774356af86de29bb59c0b4ee36237b3958ee93379375201146c6162ec66e1598df76bd98352bd68ca51fb999e0cf49091cea2e0defdb3308e0d3104977c39854deb642ef6f63eb354a94eab61bf37e4a2c9fb3d7d4591e2cfb9cffc2d573be9e56ad792fc6378e9dcc48ecea695b59e53cb2ae12a5508e14a3ce87c5a59c6fa88665400a775140c9ce01574d0cd7526b74fcef5c6b74760cceadd5f47cc61e91a88ebddd99658613ae2b1a9611e1c561ed53f27d5ad12c268a80a96765b06c50f81a75bd2005a23121f7bb9e004bce75ec54c4fa33b8ce38e6739d52810e979c3a2cfa6eaa9305c357dff9b2f5c1b7459478da993e2f4b10b78f496dfd8138365ca0c686a54f36172c6c52f19d5510c354d1f96159a82526e27a3be5ebfe564b33ab9d3aa5a12bee0a83e013b4b51168b6e0349e0e9e4a25138d9a020b6182475dfce1265a3f3634e4eccf2df83c264a4c84cf3e6058501604bfb98ebaf0bb0f675a7a2d458b372d2e312c02ad507e2930694de10ad4813273fbc60e1d57e0df117e090d01676f94216e266abf15a8d81ed10b6a5ee11e2a06c4354778ba3a3b6e3c2dca6eff05d6113b2a82ed4d4e578f436d1d50ba6d0a30889bf1047bca3426bd526e02d931d9bb863a677e4f42fb396781f2c47d6200812c56d53de32a8bf2aec2d6f14bc9afcb00cd4fe1d1b953112884ff712f763320ea533dfa481b5b796166797a7154de3d50e62065162399705ceb5934c276226906b80e7e05bb62a34e7fef5282948d2b4aadb1d41a29572ef41337e12adb1e72bb431c221d810a34a11c31337fb6e424f9e6a510da65799873e083c5365429e0903e8caee6a796c13e54b1c077fe45d999603a9d2276a3ad775a7278c0073a21a090e63974cc38d5fc767401fa54d600b4f038d02cdb0e8d6c58675d87a021fc59c20fb39a8f48f4026c22ffc9cbc7bfe30c6a2af80482930fd97d222ce2143320ae71a828b21eaf6cd799c901aa133856cb164834196a88e2ce543b84030ea599c21e352133153841ed7401a10457f090d22e6954d75ac87f44bad0516719127ce3af24dcbf8d4cbc30a53100e35e49f1e1f34b669863b8f57a7e8ee34f00694cb2b75cac8218bb5adabcd56f405810d257733e8a3f3eba273bd65d80e7292413d39fc5d9571d89fa0ee85dd192dcd6de0620d7b33b54e6ef4d57415d380cf29e78a967bc6bbbfdbffc9b3b83ec32d32d8dd7f165369812c02adf9f41bf0fbe982b9c579811c9dab5df8d4b5873654b3546fea0eb0654ef7831ab65cee53a487808a00d851b7cbbeb5a91032655b36df9627a1159c90d3f4f383001e60d1dd3ed1f238ba70a2ccf236b8e44f7b3336e56b3be6dd6957c1df0048180f4561166eafbcb94edfb0939ec7aa5e9c262681e72fdd3792d7e0e53aa33fa16409630cb5bf7bf8b38ed9a9cb93e5d4c5ebb3f504a3907b8e6253489fe0baa4912451b23a2cf4ddba03e656c91e32d1f58d89e202d63b7f17f52967f2dae66fcf7a3025cdb9ba700a4bbb9c85b695df6a59fb1ed71fed96aed4727eb5647d8cf59a7089de7a439656abdcfad6429c25cf58c6172fb5031944c0746e75a75adf9462921a2735b4cdcadae8fce622c42d4cbcbd11cc86c2e3ed9430cc2993ec483cb942577f3a87f3e58a854e72ba87c89b7b201b0fcf624ba048c405395f4bebbc6e724b29abc2cec9a37af27c49661b2b37da0d9f421641520e183f0b9223c7aa2e31e56f41d0439f3b8f40b39dc4bf643c3f6ee4b723943560bee8fa061eb20725213ffb8300749c80546be2b92adfce333e0e7e1aa99c75448dd3a6ba30f072be403823371a5320c52426fd5a2221d62eabe256fab74442b9572667b4d982cf80925a2b3ba6a3577c4a30737a192861fea7e5b8dfc0114fce283ce5834135b672436154962745380a52cadaaf7f942b16928a29f0cb4c418e2534c167c178fd62638d72eb57135767bbcaf574ebc7b10f6f4b1d117ce2572905958f5f61fd44f9b0257eae2a65cf43fdd35d9f49b01f8fecbe1f540a99e1d890da7b640fff87eef1f45586c6926835107b40dbf34836b6582c440b3cdcd6ac836bbb030cb6d8f771e8b37c8befe371063012f97fdf911ae4ef3a034b35a8cc8d00e4e061c024e1a16a3e18b205fa9c4106e3777bb76c1acccc1d539c69173643cba9ddbda30181c06821a3148c01aa71c39696f37586403c1e468a0aac613fe966cb6aa968b96f112a778778cc8b33b8f5cb9591b4721b65f4c7512c2553136ab5bb0e0042d0efa0983d45af8fdf0f0ef6e09efd762fcf7f545c5a49d0944a447566d0c9e297d490b4cb2fa3357809ff2350280eea6004731bbf49454ab36fef1db32332bb8da7b07cf98de842dcfcca9e897cc87b01f382986a0c484f8bf5b2eadeda1edf751341ca209eb4166ee3a108723ff186e2bd675d52cb5849af31ee4891eb651ef0c51151372329e32075d3ec14c3c8bf3054f4587d57c430408d41b5a700e18fbe96b19757fe1208c027c407239db002efb2910234b54c265f49f5497ae787653278b282e8fa5cafb95cce49470f200caa842ea07124c104ebbb7db063912deaee9b52d32ca9299efd0b898f8ed48d09cfa11a3e161f13999cd18bc7c3374df95c95c2be6e312836385d681939c6d4c4c5cf858d9f8c78996f500073ee6b8203d2ed529a682590ee53e97271a50b120531b0278b437eef6de2f3a5f61cd5ea5efcf6015b650ed63c165baee75d2f2586003417506674078088b5798318ce98f40f6a10cdb258d77de8e97230b11a40e06efbfdd29740a9c57c7960116eee4b16c7da803cb4a572f6228cd8568103ae3b16f3c4253e6650332da2144173e33e0e3b7340f7406f506b1f90168b73fe37679a182151e00f0498028b7293d3e8c9694cba32a3eb64f7e4c881baa039c736c2dfe4e3b4e985d8627cd369c35f60779bde5c70f028fe008124b8a6b276b59d36ea1b52a4731f436978f7ec723856acf7f5f60119de2149bec2e7f1623ece20a97f77d081b52357e8d4af7e8e02b4a863f9bba2ee244a115fe2cab3a5d882dda60b0bd714ea6140a064a2a192e2dfd4cf518a61545eda7e83aaff29489ffb359ef2c7e4eaa3b03c44e68229f1d7c4d71c6011721591158408a207f35a1dfd2fdd712596dfa89d534f8afe4f80b2a98f693361604559410a0f334340bbb8c3e6c2805bc3caf118e6c4fbcd5436b8f87d1a9dd4e310f467d27157f1becbfea5e4fc58d8dc420816dff7f2d783912a5f1f966262f3465bd15afeb8ec5dcbb581d2345da76c0ae37e72d8a20f8ad6d9ffc80f9bb061878a6fefbd59484210001a83dbc3655eafd6ef06755eba5737995a6bec0492e09e906c32a97deabd33ad059e014c9409ddfff152e00764419fc0687eef605192dce8d2cc12d41707395aa996c9897a3a9a665a9d1a8860b4ea4750385190bce208d6b6be0ec95acb0b67046cd6b0a17a325c87faf6fee97c264abf3d81eab190f7e4f108217b85d4ff62dfb30c60ef7f9dd2ce12e0c15db58c766a42429dc292bf19ff638aee100ec4e413e1f4bf7430e883d20a7fc2d7447799e5f38a6811c33c00767b7f0c199f812e59f9492766fd76143dce1a420738ac093e2e713a67a39aef35cec2ea4c8f477e4f2990d212daf99b4d24509675e563ab82358c5f7ce12cee254a20fd2487199265293fbc7453a2fc94587b3d66bfc33d661bd6eeb3830388138d83c13cb8e12291d008d6ec53de14f728c8540b76cc017a60c7cb2063a3bff8e56de6e8ea72b41464b9bb77972815113703c52536c490dbd12b2000134a8553f5f935a7e3c138ce62541b1a2c6e4a1d5a7c896f93b9d59c15c6ca1c723d50875739e028b8e47ab66d097337961207b49edbd936d2a1c1c4b1a1fdb29143d54b0de10bcacaf6d02ab006b52ff5874bccc89aadd8a2c471fb22e4a80a8176eeb6f4564127e56bfd59eeede850f8d2470ffbfa20774b965b1dd9b89de443ff81cf640c1ee845ffda6314288dad90decacc297ba3a0d89db00d513a80f0c07a2b4be57f681f999e7d3653c75ba704662858125e96c60ca84881b6b1da6090e5697412729920331439820aefd8e15948bdd18bf3f2fb3a9da5b4a45e2d7b7144fac5edfb8f2929d1700846f48f4324a3228bf957eed6b80b619d3489f55680900798a52b86a18efab3bf365a6eb335a9b1c0f1852629b4d215845d9ef6c413048ebb45f577f5248f1356fc85ea62fa4c6f26643293c3defa07fe036be82120a98e8ef0e04a4a290086c729278022360a6b4d5a8dabb8f3880a6ea789675f01ed4e5b997817703ce7e9fef0696afd6503128f35b3aa4fe66be17b3b4acb4242766b8661d12f7a8e3cd4c580bcbafa7c2a433624b57774872db1f6571de21170bb3ad205b6182eaa1e1023031239bb73848891c2b46dae4c91c3ed1fa7b1df0029910a2f44f739364f2999daaa7f3b63e542b7ee60ec3955c9de20382148b88087bc7bb0120901f8f7c656e7dbc50610d34c3ffedebcd418b1ab99f3272e2b435a13d96a1d56d1cb67698cbcf6f2d9e5652b3c888c303c0c6c94dd5dc73688d2311791873f50bf672b912ab6429c6b68f308445fb0afb5d312d5260bbf17e39210c7d455973027c494602911e2df0e6c686e1050b5a9e5d8a604f599e8b873a042da7df380cf872a06cee446181da45ca442d46eb3f2e7ec7bf22db4caae2fc21fa27db17dd93d281212c5e7d5294063a7b8f45b6269ba0eda678fd7d2df53d3472f27782016745b76098438f6fbb84d07f7b6b4d75a61c30cf6510bc7f319f0bdf715379e8365fa5101501a6ae6cb52487eb754f813e46a8bfe124a379f2ca39c8795c6c40b18ff76d3391de0293b97991fd642da8393ec0cdf9f47a14ebef192ab91670723b6076358511e5ce7935b2c762aa0ad9b9ba58f205308fdc289a2694fece41b981b8e84d8096856bed79c8e69b30b4d10a94596e1404999b0cd03841e6e0ab12ae88df3affbaf7fed0fc3639dfb902064f2bfba5ab94359c8772169da406439665d0154200cf14ebe2c1dc4eb225b96b688a646ae33f43a1f0a524844b58e1c6699d171c15b59588a48e860ff7cd9ab8342bcc82e0fbf29a62053ce4d503c0348f9d3abef0287c1b70a9feeddaa1bf05f90b463461a2c9a1b05a06a594a0d0a5a688e89ccb1aa77abfb9aa824a426f979ef2d1cbc465f3f08f6e247f6b8bd6bb00ec161a5f59cd719d5bf8626a050e36ae587ea1af71ea8844a21dbaedff3999d53c9d39bbf7daa227349f003f053dba41657b1e650245db15722fa370dbab5ce34a04e6c134c4aef7be0016770c1c8c06c29deeb190a1075f3100d6d6cd052aa190684c9d8d4b0344f5471122bf621e7fc2f98d86e96aff3f52036b5c4c65b6a79e074095e27cce733ff4e1ba4e386e70c8e764bade3d10bc6602246fdd92189f10cd9ffeb44c2a958c3976847f8303c9e3191a6474accb47cb1881af0d4fbb020e2ef41f2d50b326b99b4c5189b030674b9ddcd3b30dbde3b2057577c5351f9fc04351d16f4f379858bda7d42faf899b6bb26d937595741c0b3116930d120ce4f00812caa875eeaadc3916b03d7942cb07950939a45e29a2872d5bf45d945222c482cacf7e5af07df68bc67bb25d4d72598025a2d1883170e2175ace6255eb130a3a88d4a8379697bc643eebcf9f7f1a7eac0db7e8671047aa39e6f5c538691dcee8bf8a7c7e5af6e7185994606a423ceed10dc813b903290183f9e6f145344c84e59e603d15073776b9b64d226bdd8b5203ac21adf4d29be419b801edab91b0756e9097cc627cd50134b0f9d2d4510c0b188ea555bb53ec87b0af9ec8db571854fe55cf121801c8be15615dc344a351184770431c2667bad5aeb666ae8eefc1355d3e0d58eda61385b801ef68f4810e9553465c693b86ce2e0ca6f9fa7bf038a93d5d0f35e46cbf2cff42ca6641c7948d7a6009fc90f6df3232b8ab7fa208cd0290fe2017f47efc7ae1a68d55897534d20ec3a263dff57447983051a9f469bb8479b48b1285bf00e21411044812ab9fde5eb1c8084590939d0a0d03d3a7433bbf9263f16e53ce5d973aa4de6c42a8c1e76bb16e37553c9ddd0c323c9107fbf69d7be8a5c9842f37dbe3ab9a7b6ac1fa9d6a5e53bf052bc8eb1d2d2a82dcf9af86f371d1d9352b45945bdd602c45807e67c62429ec871b71b595e1f8b235b3cae8a65faf415e5d72d2f65d172f630abe45bd5e0c70b3d32d76b658f910bf9e5a813dc02d2e754dbe3fa62abc4fdee3ad39fac93fd91ed6affb826cae9031dff0faf1409f78153c1d80146447eeace5a2888f546a773e939a679b2f3ab7dca545d77558e3f17d1502eadf80d3b7ed461af40adc25f8d0074d478e4862fc6211af1215d81242aa7522da558eb1257a22e5a78d9613c6fc27b1202955407bf4c6c5f500d5b96073279d01032d982157d4f8208ab442d570e57efd0f6d088e7fe02fc461fa49333ef4e510281b7b6cf5903b2721515106d277ac1136d7b9713b77ef1c57c9c7179de3186179830a4496cf8805eca70d85776098c722331de436aef1b18f4f5a5cb9e97c5f4ec88c48defbbf5d2027bce43eb96d110aac5689bcb6c7009514ae6d08cb22ab699a1710dcdefb5e39bfee259787da7b85be8057fa4f28fd352204d23e50a96274f76c0f06751e5e310576575334a47d1664c4d2ed8dc7c88078ad4f088722d0d02fd7a8d4b71ca0801284c5b70b7446154ebe9cb6ba4c539ac57eba4341735d9b1059fec7bb8b08c6755981fd90469037215dfdf9c33ec33623b7c6be01eb1f3a1c6d5b5fa939d2d04654d4e7b6ef8d20da02003aa66eb294e93c34ab2564c54def267e6da71f572a33a2ff49a41e0b0740dd982347cced458bea91f021883bf763a5b5eb73b31599f36956564546a72e08039d8a082d70ca6fff74b9a0bcbdc0be6879eba3cb20ae0c9099c95bae4a0ed4557cdc135fa535ec125dbba2ab21446e993f626c8e1fe9babae3fb317d39bf6feb313bd0c86f0621eba27d80c9c46211a29529bb22434237e86be2c6a99208"
	expectedTxID := "34858b0bc84fe07064b2247fcf601417c7c62d44505e1675b03869ae6950e78c"

	txID, err := CalculateTXID(rawTx, "zcashtestnet")
	require.NoError(t, err)

	calculatedTxID := ReverseHex(txID.String())
	require.Equal(t, expectedTxID, calculatedTxID, "TXID should match for Zcash v5 transaction with Orchard actions")
}

// TestDecodeOutputs_ZcashV5_WithOrchard tests output decoding for a Zcash v5 transaction
// that contains Orchard shielded components. This verifies that transparent outputs can be
// correctly extracted even when Orchard actions are present.
func TestDecodeOutputs_ZcashV5_WithOrchard(t *testing.T) {
	// Same transaction as TestCalculateTXID_ZcashV5_WithOrchard
	// Has 1 transparent output: 0.3 ZEC to tmGMMrVJneKbZfCe1rKb96B79kYbinMpgPD
	// Has 2 Orchard actions (shielded) which are present but don't affect transparent output parsing
	rawTx := "050000800a27a726f04dec4d00000000d8503700000180c3c901000000001976a91448d094e575ccdb18c021ef25feed53b885decba088ac000002360330b959920fcbb18899886473200c4f5c4b9020dede76bfce838db8fbb1b8b4993f80320987a81f2c4f72a8466115d8f280c81a0b5eac859a1170a19cfc150b87d56a40a207746988696c806b7fccf38cef04223505c46df32eea9ba2d28bd5ab523c33a5a97027228f9750afe6358e6bb2dec113134f033f7bbbc1af282da0dafad67a016976c2c3b6c051a1a1aef1d8d55d63c04cadb5c585ca61ef4f1f58707f9c4d6adf5c444244c26bd66f373d30ea360815effb86d2c188e217bad460b53a48c6d0d67216c4599049ae3fc2acafd419282e22868f1f858fffb46f367314b64c664640dd9ecf3f75558d87adf8f5648c143ce7351fb314c0b2b1b51e1a78e51bd3c20ac328ba33d2a148b314a649e40a0cd229ce8ce746bf7f34ab44e5dcd1c4994c8f4e0925ae98626eb7315eae13a78aa4613bacbde5ea5ba6f6c41c1c893b959db391a3536de9ada97845ed34ceca129f2abeb706b8b645303b68ae90888be4ea0b43522e82ebf8bd72c1d7fc795f5b2ffb7bf8eabe3ada4ce155a67f9f46e0a8104d668352e3e17edaa42ee98b896ed93e6dddb5408b674dcf0562e8a63e98b38603eed4a780af284d026dbec32a20fdaa77a965865d154bee7185c68ebb952823dd6e3626f894f2febb067c130f352dda7cca2ce2d2c291d553668f06ecbcdbea4506135fe6a1002beeadab8b4e5bff364565c55314e347b1e3a111b8228000e73e703e72cb1294ff50961b8972048b07151471eda4180a81f7efd7c48df418b752083699fe6fef2f1dac166440d412289efef8d6ce5d75a375f363b33cf386266dd20e0f88f24a5d9dffa47fca51f9bee854cacaf9771a58d98f91eed0be345a95c1cc9943e0565799226db74de1377ce6fef9e947a6b1bc4ac2b68c31c9f4c50d42c8b674d5888eb7dd78afb1b3e6d911c11f19eaa0e6c4f5f8cb439472276689385eece41b513920da1852d273c69c68217e4474387b402e263ab17f785d07826471ff74031f6d7a2034956d6d9755830e1f40cc8654d339dedb40f83c78138a66076cdd28c69ce36379e39b7e2ae780de7b1679298c1f4a33dda4e97e426c74dab1f6145694923eefe294b5526aedd7f56f3f1a3d6cf2a032c2db5cfb2f3d797bafabdce9d11c7785f7480eb89ebb6be54c98928d1e8ece4491cb3afb11f2ea801d37d65df309b4a82a9a33761a05e84dc5e0ce1b0e2894bdc9b36a9e3aa3940a3844ef121ca6bd2d822935e1d51bca4963872da2eccf49ecce659e6ab39fa78c2e0a75af38c3e75a3122a10c9c5f0a9f081b68541d968a073257921d000a2c3a6c87aa5b7dd07ee78416159932829349676be6bc350c18f8c7505e7c9d6be6421cb6a5dd4a2f040b6c66a07cd75c65ff8f50b8978af01410762293cbdf2f6751c57683c1616e7f1da065d444bfa6d950f57e6c0a98a4a35e6c4bd930b45aae8dc6b6b9be3bf4fccc9640b397feb527d10d2159b042ff24ba7f53456b21293d84b949534c8b2bf5b5f20b60abe7cd05e084c3f29d3e3e615fe00eda4c0f19610469a9cbdc858c21030b47dcc5a9e378c371686c91871f920502ae8ff7a545d23092fd189dbaf1cc09c41f9a6a0bcea8173eafae463e2e0952733233eba7f798ca448ed8d8c89a4cefe0a67e543cb0724f4ce70b6acd8ba39f05591a0dec9a3edfc2e121514033ff699d9d6ff745e82f03de0f1736996101a44e381dfdb1770487417dc002090a8b92efacd47aed06d76cf5e95fb38ad5b76345b8b09fd7d6b9486dfcf3e14e00a805cc4a809d131d1c3e2488650698e273b864484fddd910580a2e39367750abad3c0e307638016a85bf660c112bfe8510911e01fbddf33dcd5ac74655ceec44cae8f44188672bf44f862ed65b8b211010af5f640533febcbbebbf29d4554351c1ba768752f5570ed29d04dcf88af267b3c85f0c611a764bc66a61967288b4ccbe42916093afc5665787342d2ed95b25f1932b73412978b6621935d3448c73bf51475e746cbfaa63424e3cb910c4d0871ccda96b67c24a4c9603ba284a140cebaaaa4806610070d9e60b10e6fa86d892d7b59b6062c2c40772a9140a0dfc83a935d804dd55dae169ff1c0ee157cc0290730a0bb232cb9506749eea8852c452de6f983ce69123fd836387a3dcbe31bfda549b479ac7c7dda3e27ac929cdaecc51b0c5d68e0ac591dcb43ca219250e97f647cec594f079b631d66d122d809146409e37b7bfc8b4301ce30e98a562ecbdf49b438d518417bac58e68be796668be73fc6cc0967706a945fa12417dffed6fb24a7c1183e1d84cb91f0318fec90100000000670a083636e279714d39a644d5c63d367dbe2ae23e0ce770629bee5395d84907fd601cefa13a952a5e69236c32f5c7bad01eedc19421ff2d42a2269d81d330e19dc525fe3f4dafe461f0b234a9477cb410f1513c574b975581fe66037c6b4c2cbd3cb9beb0a8e9e46312691bba3e016182f27d7f4d464bc91b0c8efb83ebd3713ec4a8893537fbcc3b4f3a60fe0ac2ab5815f261b845a89d2fcde1e72200d6d876d337d13ecc09424be84d2247f9986db18a111d368221aa8bf11b9dfbf7bbaf9e91a2ae96908606645447972771d650eae56700105ce9f7dd7fae81903532e52cca80acf44e8882f1efe997936601a57de35ce5281fb4e691d08ab380186e09cec01f2628e878693ea4264842033cf082c741a271f51583f99a94e0eda771f2dd88129e8ed96ce2df3c0981f6b1cf61cf4cebea56f0bb8573f3095d333edfb1aa4d2677dcb7025340fbe8844ce4b6c29150faf9ff28d745de7d8109c344a16f85ab21867d4950c7a08787b1af76edfd1df0da14660099a9d83c4bc58c41df5e0ed814498f8de6415cb4e5c330bbe519700f3cef293f3946c168130c1b9fd15d0d24a7daa16491157c53554e7baa9a5e6b8ea42f66a27ff40762e895fd4a1f5adf7d2b2514f13e0e342ae00cf77e1f87cd1a9ce6e24afe50ef512a5e4ed2fd0eca46a910db181e7a4b99b4b30a8ca3cec498ac51f6086fcf3a084b98ddf4a727872008ce6a760617fabc35467870202eec48f9a549675780db2c679569d550ddb8f0adb83af5d93b0d35c9750f0cf21b299491924923e01cb7d803d6feda467cff3e3e3358ec7ea219811c20c984cc925d57269f395922fa323b40b25d43da422418361758a74444ab19c751988da004a58be7de93cf339555272469b4bbd8fd461ca4a9a834c6e942e0995190729b1c98232e208f3446c57b453fcf3511b3e2de86a98f4c9e48eb915435ed419612139f53839bafae9ca0fc22ec14a76eec9e0b2432942c9c17a4c2b56bd553559b529cab5e60db28d751b3b40411878b54317709a5e8a00f0fc43a7e3988c057c7df174ed86752a1dd51354d0c854595edcec50c217cbb183d407ee044d5e434218d1187e51bef41ff10c5bc9724c0955b9cbb5c0fadf5e29e384004871a7433be0c4b30a712e438241a3e5890fc698ec618a177816b0bbe5f1913730bc4d935c9cd2a59146510fa198b40e5e9cb81f6c1beb59b987957117ca84231977594e5524765e4827c77148f219a2a36b5e9cdf0f9bc433968f9610e412435981c8df464977475ae90f4f90313afc2c8a70b16852510341ed7ee98d5578c1359a84964adbd1fbb2fe2e50d419325d04e7f10f717c9bc008479e62cdd02852d6fc06268a0fba28ca7a13c01b947f245ae854bb629170d38b54419b1e4ceba0765823330a959fd025351bcb2605ee74f78eba423edab628625c1e6e2c9f3bd29ef169b93fb97cf129dabd79879df6babad076c39f98ee578a0993805a8863c378b007f19f4ec5714e93c825a4fba4b18ac8c77ed542b2d1619b0a427def8f54a732beb8f02e6fa4df8157ff1d5365a9be8316eda5467bc0f3d3bb846e6e1f1e7491f34a7c3648e184983327433a2ed7634c2cc56939769c310e632e48c82bdcd2af71899f1f8c27befa86c3fab9f89f5aa466d436cf68e21bf656e7c34e5fb3920f759e0f2301f5d1d71b531d88fbcb690be945048a5ac481269fd190b8a197bdc9ceba91597548c23cbab95e40e4db89de1a9c85a6da55fa290e33ae626308e02336094d839dd4d30556790db9d13749707ed8c8e8f49c693037ebb25ae77ab775ffaf009201a1c856832889d1b85af149a1c4a2416f7e7194e9b389195b101ed87797486db7193b0ac335908ee5e0f3ded6d8e8fc845ac070f81c45e1600cbeeb06e19a220730848fcf935ac77e3cc56bd65feb0477ec010631db9d4482046e0f80f6c85e022d0f09e7b423312c093105d917cab2d488eb9e7b984620c065930c88ea188c207e7d137be28a192eef9f5c4ffd4c9f0218b3b2d585a98ce0aabc419022af41c0e1b46b13d97e0b21a5a218d4d9310a525f699e5654b38ccd34c0bc63a1577e8f68120b40110a06e7969cbda914f9b34db24265c0f4091822c402d6b6b7a367d0ab85f318fd65950a4dcee76ea754ba57dda12e43270eb807397b9d3f395d005007a6156e291e1eb203772497ac652d1c64f958bdaa67643557b7a5f51760ba00b6edc87c1cf76fd71c85443e740691d914c9e5c0184d913cea0aeb352c6f1feb263d2fb6e5d0dc2a44359cbbdfaf3a65c50862808b1b6f84787c8cd40845a1ac55d7756624fab295f7993439bffaafafeb223a70cc53424298f0be44660f4ce2681ca0b4318fb170b0140775b45b5f2112f06a071cf23dd0c9696aa761094eb42f2da8e27c9e9f167c99a86eb53d915930000d5247722c6ebaba89ab6f3b8eccc3a67b19b0c1d6c012d81179f78cede6e0818105d99a92a15e2a4eb01d9c9f0d8752ee9909ad6c3b9d9d7d3f04d5af22647099152aea69625dff93e371e31deb28f53a90b5a385340c426202defe0f5683915bfc24741c743f4ff3de88e9227a409139c2b12e9938c92422b99ce3355120412497f200b9147d779fc93312a7a4b568a207b4cfe2cccd895fb7fdff3c1dd251d7ce87477f03858c96ef331a9cafe358b72c3802ee5512521034e276e3176791eac5849c3c2ea5bea45463dece300dfb4c965e7c57cfb3426879a3d67243ece29e359d92e1a0aaef846be18f3c0b26a038e681b6756c82fb03e65931018d0aa0f12461c3deaa77c2f4657a8c1ddd22ca6e7a4e4a1f84fe17785d0d8ec5af7ea368d99b23720261293ca06c674fde4c9638204e3a57ebf867a0fd0a4a9f12270115e1c94a6a1146ea466fd16cf2995f963af1e80dbc44f43ece2f65d26a99a731fdf038a79ae2f0b6f9caab655e105df38b20951f2e6255f7146d46318c96920209b85727222522ddb42fad47425016c5ff565f459ce51939eacdd1bdcb504ff31f20a0fe53913d365b3b168079a0569e57d0d1554e8db391cd9f9ea04bb4ef1026ba4aead62c29381237e0832de05234984d60dbda4cfa9d0658f02138a89033269ed87deb22f25dd51479e2115bff7dc551416f55c56993f229bdf6017f09319c098914eda0579e8324a1e568a16d844cde417d7466f032fceb60828f7499322ce888542c001c4d2fb5b18ddc64945b3c7e6cf535d4efa4646ab6087890b7007d45a08f25974df586313added9810fb9575f6dc91a4c957c05faae17d1516023bc7ae205d5b1f07c64133e76ff0c3a14a1148655ede43ac508326111e732392d7005fbcdbded726c5de77312d6f46eb1f2b6f63af743bda97e37fa0a4df649396ef260ae2b781a26ac0d7e8e83a5bdaaf250821f603e28782da113036c30d81f7e84a957cab89e740b4914277aa4d90b5213e9927be483537209e9e7046b5b1f6875fe94b31125dd774356af86de29bb59c0b4ee36237b3958ee93379375201146c6162ec66e1598df76bd98352bd68ca51fb999e0cf49091cea2e0defdb3308e0d3104977c39854deb642ef6f63eb354a94eab61bf37e4a2c9fb3d7d4591e2cfb9cffc2d573be9e56ad792fc6378e9dcc48ecea695b59e53cb2ae12a5508e14a3ce87c5a59c6fa88665400a775140c9ce01574d0cd7526b74fcef5c6b74760cceadd5f47cc61e91a88ebddd99658613ae2b1a9611e1c561ed53f27d5ad12c268a80a96765b06c50f81a75bd2005a23121f7bb9e004bce75ec54c4fa33b8ce38e6739d52810e979c3a2cfa6eaa9305c357dff9b2f5c1b7459478da993e2f4b10b78f496dfd8138365ca0c686a54f36172c6c52f19d5510c354d1f96159a82526e27a3be5ebfe564b33ab9d3aa5a12bee0a83e013b4b51168b6e0349e0e9e4a25138d9a020b6182475dfce1265a3f3634e4eccf2df83c264a4c84cf3e6058501604bfb98ebaf0bb0f675a7a2d458b372d2e312c02ad507e2930694de10ad4813273fbc60e1d57e0df117e090d01676f94216e266abf15a8d81ed10b6a5ee11e2a06c4354778ba3a3b6e3c2dca6eff05d6113b2a82ed4d4e578f436d1d50ba6d0a30889bf1047bca3426bd526e02d931d9bb863a677e4f42fb396781f2c47d6200812c56d53de32a8bf2aec2d6f14bc9afcb00cd4fe1d1b953112884ff712f763320ea533dfa481b5b796166797a7154de3d50e62065162399705ceb5934c276226906b80e7e05bb62a34e7fef5282948d2b4aadb1d41a29572ef41337e12adb1e72bb431c221d810a34a11c31337fb6e424f9e6a510da65799873e083c5365429e0903e8caee6a796c13e54b1c077fe45d999603a9d2276a3ad775a7278c0073a21a090e63974cc38d5fc767401fa54d600b4f038d02cdb0e8d6c58675d87a021fc59c20fb39a8f48f4026c22ffc9cbc7bfe30c6a2af80482930fd97d222ce2143320ae71a828b21eaf6cd799c901aa133856cb164834196a88e2ce543b84030ea599c21e352133153841ed7401a10457f090d22e6954d75ac87f44bad0516719127ce3af24dcbf8d4cbc30a53100e35e49f1e1f34b669863b8f57a7e8ee34f00694cb2b75cac8218bb5adabcd56f405810d257733e8a3f3eba273bd65d80e7292413d39fc5d9571d89fa0ee85dd192dcd6de0620d7b33b54e6ef4d57415d380cf29e78a967bc6bbbfdbffc9b3b83ec32d32d8dd7f165369812c02adf9f41bf0fbe982b9c579811c9dab5df8d4b5873654b3546fea0eb0654ef7831ab65cee53a487808a00d851b7cbbeb5a91032655b36df9627a1159c90d3f4f383001e60d1dd3ed1f238ba70a2ccf236b8e44f7b3336e56b3be6dd6957c1df0048180f4561166eafbcb94edfb0939ec7aa5e9c262681e72fdd3792d7e0e53aa33fa16409630cb5bf7bf8b38ed9a9cb93e5d4c5ebb3f504a3907b8e6253489fe0baa4912451b23a2cf4ddba03e656c91e32d1f58d89e202d63b7f17f52967f2dae66fcf7a3025cdb9ba700a4bbb9c85b695df6a59fb1ed71fed96aed4727eb5647d8cf59a7089de7a439656abdcfad6429c25cf58c6172fb5031944c0746e75a75adf9462921a2735b4cdcadae8fce622c42d4cbcbd11cc86c2e3ed9430cc2993ec483cb942577f3a87f3e58a854e72ba87c89b7b201b0fcf624ba048c405395f4bebbc6e724b29abc2cec9a37af27c49661b2b37da0d9f421641520e183f0b9223c7aa2e31e56f41d0439f3b8f40b39dc4bf643c3f6ee4b723943560bee8fa061eb20725213ffb8300749c80546be2b92adfce333e0e7e1aa99c75448dd3a6ba30f072be403823371a5320c52426fd5a2221d62eabe256fab74442b9572667b4d982cf80925a2b3ba6a3577c4a30737a192861fea7e5b8dfc0114fce283ce5834135b672436154962745380a52cadaaf7f942b16928a29f0cb4c418e2534c167c178fd62638d72eb57135767bbcaf574ebc7b10f6f4b1d117ce2572905958f5f61fd44f9b0257eae2a65cf43fdd35d9f49b01f8fecbe1f540a99e1d890da7b640fff87eef1f45586c6926835107b40dbf34836b6582c440b3cdcd6ac836bbb030cb6d8f771e8b37c8befe371063012f97fdf911ae4ef3a034b35a8cc8d00e4e061c024e1a16a3e18b205fa9c4106e3777bb76c1acccc1d539c69173643cba9ddbda30181c06821a3148c01aa71c39696f37586403c1e468a0aac613fe966cb6aa968b96f112a778778cc8b33b8f5cb9591b4721b65f4c7512c2553136ab5bb0e0042d0efa0983d45af8fdf0f0ef6e09efd762fcf7f545c5a49d0944a447566d0c9e297d490b4cb2fa3357809ff2350280eea6004731bbf49454ab36fef1db32332bb8da7b07cf98de842dcfcca9e897cc87b01f382986a0c484f8bf5b2eadeda1edf751341ca209eb4166ee3a108723ff186e2bd675d52cb5849af31ee4891eb651ef0c51151372329e32075d3ec14c3c8bf3054f4587d57c430408d41b5a700e18fbe96b19757fe1208c027c407239db002efb2910234b54c265f49f5497ae787653278b282e8fa5cafb95cce49470f200caa842ea07124c104ebbb7db063912deaee9b52d32ca9299efd0b898f8ed48d09cfa11a3e161f13999cd18bc7c3374df95c95c2be6e312836385d681939c6d4c4c5cf858d9f8c78996f500073ee6b8203d2ed529a682590ee53e97271a50b120531b0278b437eef6de2f3a5f61cd5ea5efcf6015b650ed63c165baee75d2f2586003417506674078088b5798318ce98f40f6a10cdb258d77de8e97230b11a40e06efbfdd29740a9c57c7960116eee4b16c7da803cb4a572f6228cd8568103ae3b16f3c4253e6650332da2144173e33e0e3b7340f7406f506b1f90168b73fe37679a182151e00f0498028b7293d3e8c9694cba32a3eb64f7e4c881baa039c736c2dfe4e3b4e985d8627cd369c35f60779bde5c70f028fe008124b8a6b276b59d36ea1b52a4731f436978f7ec723856acf7f5f60119de2149bec2e7f1623ece20a97f77d081b52357e8d4af7e8e02b4a863f9bba2ee244a115fe2cab3a5d882dda60b0bd714ea6140a064a2a192e2dfd4cf518a61545eda7e83aaff29489ffb359ef2c7e4eaa3b03c44e68229f1d7c4d71c6011721591158408a207f35a1dfd2fdd712596dfa89d534f8afe4f80b2a98f693361604559410a0f334340bbb8c3e6c2805bc3caf118e6c4fbcd5436b8f87d1a9dd4e310f467d27157f1becbfea5e4fc58d8dc420816dff7f2d783912a5f1f966262f3465bd15afeb8ec5dcbb581d2345da76c0ae37e72d8a20f8ad6d9ffc80f9bb061878a6fefbd59484210001a83dbc3655eafd6ef06755eba5737995a6bec0492e09e906c32a97deabd33ad059e014c9409ddfff152e00764419fc0687eef605192dce8d2cc12d41707395aa996c9897a3a9a665a9d1a8860b4ea4750385190bce208d6b6be0ec95acb0b67046cd6b0a17a325c87faf6fee97c264abf3d81eab190f7e4f108217b85d4ff62dfb30c60ef7f9dd2ce12e0c15db58c766a42429dc292bf19ff638aee100ec4e413e1f4bf7430e883d20a7fc2d7447799e5f38a6811c33c00767b7f0c199f812e59f9492766fd76143dce1a420738ac093e2e713a67a39aef35cec2ea4c8f477e4f2990d212daf99b4d24509675e563ab82358c5f7ce12cee254a20fd2487199265293fbc7453a2fc94587b3d66bfc33d661bd6eeb3830388138d83c13cb8e12291d008d6ec53de14f728c8540b76cc017a60c7cb2063a3bff8e56de6e8ea72b41464b9bb77972815113703c52536c490dbd12b2000134a8553f5f935a7e3c138ce62541b1a2c6e4a1d5a7c896f93b9d59c15c6ca1c723d50875739e028b8e47ab66d097337961207b49edbd936d2a1c1c4b1a1fdb29143d54b0de10bcacaf6d02ab006b52ff5874bccc89aadd8a2c471fb22e4a80a8176eeb6f4564127e56bfd59eeede850f8d2470ffbfa20774b965b1dd9b89de443ff81cf640c1ee845ffda6314288dad90decacc297ba3a0d89db00d513a80f0c07a2b4be57f681f999e7d3653c75ba704662858125e96c60ca84881b6b1da6090e5697412729920331439820aefd8e15948bdd18bf3f2fb3a9da5b4a45e2d7b7144fac5edfb8f2929d1700846f48f4324a3228bf957eed6b80b619d3489f55680900798a52b86a18efab3bf365a6eb335a9b1c0f1852629b4d215845d9ef6c413048ebb45f577f5248f1356fc85ea62fa4c6f26643293c3defa07fe036be82120a98e8ef0e04a4a290086c729278022360a6b4d5a8dabb8f3880a6ea789675f01ed4e5b997817703ce7e9fef0696afd6503128f35b3aa4fe66be17b3b4acb4242766b8661d12f7a8e3cd4c580bcbafa7c2a433624b57774872db1f6571de21170bb3ad205b6182eaa1e1023031239bb73848891c2b46dae4c91c3ed1fa7b1df0029910a2f44f739364f2999daaa7f3b63e542b7ee60ec3955c9de20382148b88087bc7bb0120901f8f7c656e7dbc50610d34c3ffedebcd418b1ab99f3272e2b435a13d96a1d56d1cb67698cbcf6f2d9e5652b3c888c303c0c6c94dd5dc73688d2311791873f50bf672b912ab6429c6b68f308445fb0afb5d312d5260bbf17e39210c7d455973027c494602911e2df0e6c686e1050b5a9e5d8a604f599e8b873a042da7df380cf872a06cee446181da45ca442d46eb3f2e7ec7bf22db4caae2fc21fa27db17dd93d281212c5e7d5294063a7b8f45b6269ba0eda678fd7d2df53d3472f27782016745b76098438f6fbb84d07f7b6b4d75a61c30cf6510bc7f319f0bdf715379e8365fa5101501a6ae6cb52487eb754f813e46a8bfe124a379f2ca39c8795c6c40b18ff76d3391de0293b97991fd642da8393ec0cdf9f47a14ebef192ab91670723b6076358511e5ce7935b2c762aa0ad9b9ba58f205308fdc289a2694fece41b981b8e84d8096856bed79c8e69b30b4d10a94596e1404999b0cd03841e6e0ab12ae88df3affbaf7fed0fc3639dfb902064f2bfba5ab94359c8772169da406439665d0154200cf14ebe2c1dc4eb225b96b688a646ae33f43a1f0a524844b58e1c6699d171c15b59588a48e860ff7cd9ab8342bcc82e0fbf29a62053ce4d503c0348f9d3abef0287c1b70a9feeddaa1bf05f90b463461a2c9a1b05a06a594a0d0a5a688e89ccb1aa77abfb9aa824a426f979ef2d1cbc465f3f08f6e247f6b8bd6bb00ec161a5f59cd719d5bf8626a050e36ae587ea1af71ea8844a21dbaedff3999d53c9d39bbf7daa227349f003f053dba41657b1e650245db15722fa370dbab5ce34a04e6c134c4aef7be0016770c1c8c06c29deeb190a1075f3100d6d6cd052aa190684c9d8d4b0344f5471122bf621e7fc2f98d86e96aff3f52036b5c4c65b6a79e074095e27cce733ff4e1ba4e386e70c8e764bade3d10bc6602246fdd92189f10cd9ffeb44c2a958c3976847f8303c9e3191a6474accb47cb1881af0d4fbb020e2ef41f2d50b326b99b4c5189b030674b9ddcd3b30dbde3b2057577c5351f9fc04351d16f4f379858bda7d42faf899b6bb26d937595741c0b3116930d120ce4f00812caa875eeaadc3916b03d7942cb07950939a45e29a2872d5bf45d945222c482cacf7e5af07df68bc67bb25d4d72598025a2d1883170e2175ace6255eb130a3a88d4a8379697bc643eebcf9f7f1a7eac0db7e8671047aa39e6f5c538691dcee8bf8a7c7e5af6e7185994606a423ceed10dc813b903290183f9e6f145344c84e59e603d15073776b9b64d226bdd8b5203ac21adf4d29be419b801edab91b0756e9097cc627cd50134b0f9d2d4510c0b188ea555bb53ec87b0af9ec8db571854fe55cf121801c8be15615dc344a351184770431c2667bad5aeb666ae8eefc1355d3e0d58eda61385b801ef68f4810e9553465c693b86ce2e0ca6f9fa7bf038a93d5d0f35e46cbf2cff42ca6641c7948d7a6009fc90f6df3232b8ab7fa208cd0290fe2017f47efc7ae1a68d55897534d20ec3a263dff57447983051a9f469bb8479b48b1285bf00e21411044812ab9fde5eb1c8084590939d0a0d03d3a7433bbf9263f16e53ce5d973aa4de6c42a8c1e76bb16e37553c9ddd0c323c9107fbf69d7be8a5c9842f37dbe3ab9a7b6ac1fa9d6a5e53bf052bc8eb1d2d2a82dcf9af86f371d1d9352b45945bdd602c45807e67c62429ec871b71b595e1f8b235b3cae8a65faf415e5d72d2f65d172f630abe45bd5e0c70b3d32d76b658f910bf9e5a813dc02d2e754dbe3fa62abc4fdee3ad39fac93fd91ed6affb826cae9031dff0faf1409f78153c1d80146447eeace5a2888f546a773e939a679b2f3ab7dca545d77558e3f17d1502eadf80d3b7ed461af40adc25f8d0074d478e4862fc6211af1215d81242aa7522da558eb1257a22e5a78d9613c6fc27b1202955407bf4c6c5f500d5b96073279d01032d982157d4f8208ab442d570e57efd0f6d088e7fe02fc461fa49333ef4e510281b7b6cf5903b2721515106d277ac1136d7b9713b77ef1c57c9c7179de3186179830a4496cf8805eca70d85776098c722331de436aef1b18f4f5a5cb9e97c5f4ec88c48defbbf5d2027bce43eb96d110aac5689bcb6c7009514ae6d08cb22ab699a1710dcdefb5e39bfee259787da7b85be8057fa4f28fd352204d23e50a96274f76c0f06751e5e310576575334a47d1664c4d2ed8dc7c88078ad4f088722d0d02fd7a8d4b71ca0801284c5b70b7446154ebe9cb6ba4c539ac57eba4341735d9b1059fec7bb8b08c6755981fd90469037215dfdf9c33ec33623b7c6be01eb1f3a1c6d5b5fa939d2d04654d4e7b6ef8d20da02003aa66eb294e93c34ab2564c54def267e6da71f572a33a2ff49a41e0b0740dd982347cced458bea91f021883bf763a5b5eb73b31599f36956564546a72e08039d8a082d70ca6fff74b9a0bcbdc0be6879eba3cb20ae0c9099c95bae4a0ed4557cdc135fa535ec125dbba2ab21446e993f626c8e1fe9babae3fb317d39bf6feb313bd0c86f0621eba27d80c9c46211a29529bb22434237e86be2c6a99208"

	outputs, err := DecodeOutputs(rawTx, "zcashtestnet")
	require.NoError(t, err, "Should successfully decode transparent outputs")
	require.Len(t, outputs, 1, "Should have 1 transparent output")

	// Verify the transparent output details
	require.Equal(t, uint(0), outputs[0].OutputIndex)
	require.Equal(t, uint64(30000000), outputs[0].Amount, "Should be 0.3 ZEC = 30000000 zatoshis")
	require.Equal(t, "tmGMMrVJneKbZfCe1rKb96B79kYbinMpgPD", outputs[0].Address)
}

// TestZcashV1 tests version 1 transactions
func TestZcashV1(t *testing.T) {
	rawTx := "010000000194a33cd0da142112b5ef2f3ce173840a104329f35d63ac06367d469beef30eec000000006b483045022100fc3548bd728533c1f07dfd76188412426267249e406eb440d4ffee467df4ae2802206b123abe22df099072f6202436ccb07cdf06cbc82262db5931f5c322c6985669012103590f25b9248ff4b8dcb344b43fce95e4801c31f28e5cd335b553b0f7298719c2ffffffff02404b4c00000000001976a91448d094e575ccdb18c021ef25feed53b885decba088ac30517d01000000001976a9145fc0e3503739df8b38b312ceca28a024404162eb88ac00000000"
	expectedTxID := "889cb4b6383ca4056f7c837b55c5b32acbf90f0d1c239af4cc99b779fa279a1d"

	txID, err := CalculateTXID(rawTx, "zcashtestnet")
	require.NoError(t, err)
	require.Equal(t, expectedTxID, ReverseHex(txID.String()))

	outputs, err := DecodeOutputs(rawTx, "zcashtestnet")
	require.NoError(t, err)
	require.Len(t, outputs, 2)
	require.Equal(t, uint64(5000000), outputs[0].Amount)
	require.Equal(t, "tmGMMrVJneKbZfCe1rKb96B79kYbinMpgPD", outputs[0].Address)
}

// TestZcashV2 tests version 2 transactions
func TestZcashV2(t *testing.T) {
	rawTx := "0200000001ec0ef3ee9b467d3606ac635df32943100a8473e13c2fefb5122114dad03ca394000000006a473044022056d4490970d3759101f0a80b2755d15a46ea7cc9a27a3850468a4ca34d95c5c702201de7960c0a57b6535dc2d5f7eff0d7fb31080b42158709c1deb4187e8cadaed9012103590f25b9248ff4b8dcb344b43fce95e4801c31f28e5cd335b553b0f7298719c2ffffffff02404b4c00000000001976a91448d094e575ccdb18c021ef25feed53b885decba088ac30517d01000000001976a9145fc0e3503739df8b38b312ceca28a024404162eb88ac0000000000"
	expectedTxID := "f0cba0e7a29ae6d4f68d77b0b1685b112b5f36566daf818592578ba520f36861"

	txID, err := CalculateTXID(rawTx, "zcashtestnet")
	require.NoError(t, err)
	require.Equal(t, expectedTxID, ReverseHex(txID.String()))

	outputs, err := DecodeOutputs(rawTx, "zcashtestnet")
	require.NoError(t, err)
	require.Len(t, outputs, 2)
	require.Equal(t, uint64(5000000), outputs[0].Amount)
}

// TestZcashV3 tests version 3 transactions (Sapling)
func TestZcashV3(t *testing.T) {
	rawTx := "030000807082c40301ec0ef3ee9b467d3606ac635df32943100a8473e13c2fefb5122114dad03ca394000000006b48304502210091fd1aea5ea95a6ca2f16d2af8368cb085c238046e84ea458e7d7c33f750b0e4022050f3a1ef3e6bb80d04957d06978515a597a4d7b611ab26756266c4ec9d17a360012103590f25b9248ff4b8dcb344b43fce95e4801c31f28e5cd335b553b0f7298719c2ffffffff02404b4c00000000001976a91448d094e575ccdb18c021ef25feed53b885decba088ac30517d01000000001976a9145fc0e3503739df8b38b312ceca28a024404162eb88ac000000000000000000"
	expectedTxID := "f1b8a772a347edc6e91a0a51b307bf63dbe4ea7a6b6585f4e60209e34fbb4611"

	txID, err := CalculateTXID(rawTx, "zcashtestnet")
	require.NoError(t, err)
	require.Equal(t, expectedTxID, ReverseHex(txID.String()))

	outputs, err := DecodeOutputs(rawTx, "zcashtestnet")
	require.NoError(t, err)
	require.Len(t, outputs, 2)
	require.Equal(t, uint64(5000000), outputs[0].Amount)
}

// TestZcashV4 tests version 4 transactions
func TestZcashV4(t *testing.T) {
	rawTx := "0400008085202f8901ec0ef3ee9b467d3606ac635df32943100a8473e13c2fefb5122114dad03ca394000000006a473044022020794c702dc1b8f14649937be5d73ddc41f9409ca187ce6db2beb753b4c7a652022038ee8d30003f6e7cc3e22853131179de68e2db8b48d814505deccbf9d2dc642a012103590f25b9248ff4b8dcb344b43fce95e4801c31f28e5cd335b553b0f7298719c2ffffffff02404b4c00000000001976a91448d094e575ccdb18c021ef25feed53b885decba088ac30517d01000000001976a9145fc0e3503739df8b38b312ceca28a024404162eb88ac00000000000000000000000000000000000000"
	expectedTxID := "9034536fe147dea52f61341ad88a4d1afa4cf4c5a1e212b73d73bbe597e7b0e9"

	txID, err := CalculateTXID(rawTx, "zcashtestnet")
	require.NoError(t, err)
	require.Equal(t, expectedTxID, ReverseHex(txID.String()))

	outputs, err := DecodeOutputs(rawTx, "zcashtestnet")
	require.NoError(t, err)
	require.Len(t, outputs, 2)
	require.Equal(t, uint64(5000000), outputs[0].Amount)
}

// TestZcashV5_Additional tests an additional v5 transaction
func TestZcashV5_Additional(t *testing.T) {
	rawTx := "050000800a27a72621965137000000000000000001ec0ef3ee9b467d3606ac635df32943100a8473e13c2fefb5122114dad03ca394000000006a473044022030d750337aa3ccff4fcc3571f12dc0780dc854599dc68e50d6c1f3b771d5ebd402207edbdfc20a5336065e2e0b4bf5145f399fbf22e97cb0d05859bec8372dec28b5012103590f25b9248ff4b8dcb344b43fce95e4801c31f28e5cd335b553b0f7298719c2ffffffff02404b4c00000000001976a91448d094e575ccdb18c021ef25feed53b885decba088ac30517d01000000001976a9145fc0e3503739df8b38b312ceca28a024404162eb88ac000000"
	expectedTxID := "dc2a960c3e8be30a47ff9b77922bebc967feffcb9736789e421ef6cd9d79472f"

	txID, err := CalculateTXID(rawTx, "zcashtestnet")
	require.NoError(t, err)
	require.Equal(t, expectedTxID, ReverseHex(txID.String()))

	outputs, err := DecodeOutputs(rawTx, "zcashtestnet")
	require.NoError(t, err)
	require.Len(t, outputs, 2)
	require.Equal(t, uint64(5000000), outputs[0].Amount)
	require.Equal(t, "tmGMMrVJneKbZfCe1rKb96B79kYbinMpgPD", outputs[0].Address)
}
